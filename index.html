<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>rizma</title>
  <!-- Favicons -->
  <link rel="icon" href="./assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-touch-icon.png">
  <link rel="mask-icon" href="./assets/safari-pinned-tab.svg" color="#0E0E10">
  <link rel="stylesheet" href="./styles/tokens.css">
  <link rel="stylesheet" href="./styles/app.css">
</head>

<body>
  <!-- Header / Brand -->
  <header class="container">
    <div class="brand">
      <img src="./assets/rizma_logo_color.png" alt="rizma logo">
      <div class="name">rizma</div>
    </div>
    <h2 id="subtitle" class="page-subtitle">Support Between Sessions</h2>
  </header>

  <!-- Mode Tabs -->
  <nav class="tabs container" aria-label="Mode">
    <button id="tabRealtime" class="tab active" type="button">OpenAI Realtime</button>
    <button id="tabAvatar" class="tab" type="button">Avatar</button>
  </nav>

  <!-- Therapist Card (Realtime default view) -->
  <section class="card">
    <img src="./assets/rizma-doc-3-elena_cropped.png" alt="Elena" class="avatar" />
    <h1 class="title">Elena</h1>
    <p class="lead">Helps with homework and answers questions.</p>
    <!-- hidden legacy button (kept for accessibility/testing) -->
    <button id="hold" aria-pressed="false" aria-label="Start Voice Session" class="mic-btn hidden">
      <svg viewBox="0 0 32 32" width="28" height="28" aria-hidden="true" focusable="false" fill="currentColor">
        <rect x="2" y="12" width="4" height="8" rx="2"></rect>
        <rect x="8" y="8" width="4" height="16" rx="2"></rect>
        <rect x="14" y="4" width="4" height="24" rx="2"></rect>
        <rect x="20" y="8" width="4" height="16" rx="2"></rect>
        <rect x="26" y="12" width="4" height="8" rx="2"></rect>
      </svg>
      <span class="sr-only">Start Voice Session</span>
    </button>
  </section>

  <audio id="remoteAudio" autoplay playsinline style="display:none;"></audio>
  <!-- Fallback audio for HTTP TTS when Realtime fails -->
  <audio id="fallbackAudio" playsinline style="display:none;"></audio>

  <!-- Conversation Panel (Realtime) -->
  <section id="panel" class="container hidden">
    <div style="display:flex; justify-content:flex-end; position:relative;">
      <button id="endSession" class="panel-close" aria-label="End session" title="End session">
        <span aria-hidden="true" style="font-size:20px;line-height:1">&times;</span>
        <span class="sr-only">End session</span>
      </button>
    </div>
    <div id="status">Idle</div>
    <div id="chat" style="display:flex; flex-direction:column; gap:8px; max-height:40vh; overflow:auto; padding-right:6px;"></div>
  </section>

  <!-- Avatar / Annie Panel (hidden until selected) -->
  <section id="avatarPanel" class="container hidden">
    <div class="card" style="text-align:left">
      <div class="row" style="margin-bottom:8px">
        <input id="annieToken" class="input" placeholder="Session access token" />
      </div>
      <div class="row" style="margin-bottom:8px">
        <input id="annieUserId" class="input" placeholder="User ID" />
        <input id="annieAnimatoId" class="input" placeholder="Animato ID" value="annie" />
      </div>
      <div class="row" style="margin-bottom:8px">
        <label style="display:flex;align-items:center;gap:6px">
          <input type="checkbox" id="annieMic" checked /> Mic
        </label>
        <button id="annieConnect" class="btn" type="button">Connect</button>
        <button id="annieDisconnect" class="btn secondary" type="button">Disconnect</button>
      </div>
      <!-- Stage: big avatar with small self camera in the corner -->
      <div id="annieStage" class="annie-stage" style="margin-top:12px">
        <div id="annieRoot" class="annie-root"></div>
        <video id="selfCam" class="self-cam" autoplay playsinline muted></video>
      </div>
      <div class="row" style="margin-top:10px">
        <input id="annieMessage" class="input" placeholder="Message" />
        <button id="annieSend" class="btn" type="button">Send</button>
      </div>
    </div>
  </section>

  <!-- Chat composer with waveform mic (Realtime) -->
  <section id="composer" class="composer">
    <button id="composerPlus" aria-label="Add" title="Add" class="mic-btn" style="width:36px;height:36px;border-radius:18px">
      +
    </button>
    <div id="composerInput" class="pill">Ask anything</div>
    <button id="micFab" class="mic-btn" aria-label="Start Voice Session" title="Start Voice Session">
      <svg viewBox="0 0 32 32" width="22" height="22" aria-hidden="true" focusable="false" fill="currentColor">
        <rect x="2" y="12" width="4" height="8" rx="2"></rect>
        <rect x="8" y="8" width="4" height="16" rx="2"></rect>
        <rect x="14" y="4" width="4" height="24" rx="2"></rect>
        <rect x="20" y="8" width="4" height="16" rx="2"></rect>
        <rect x="26" y="12" width="4" height="8" rx="2"></rect>
      </svg>
    </button>
  </section>

  <!-- Footer -->
  <footer class="foot">
    <span>Secure &bull; Private &bull; Professional</span>
    <button id="reset" style="margin-left:12px; font-size:12px; color:#6B6B6B; background:transparent; border:none; text-decoration:underline; cursor:pointer;">Reset Session</button>
  </footer>

  <script type="module" src="/src/main.ts"></script>
</body>

</html>